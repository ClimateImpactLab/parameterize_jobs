language: python
python:
- 3.6
- 3.7
- 2.7

env:
  matrix:
  - TEST_ENV=tox
  - TEST_ENV=conda

install:
- pip install --upgrade pip
- if [[ "$TEST_ENV" == "conda" ]]; then
    if [[ "$TRAVIS_PYTHON_VERSION" == "2.7" ]]; then
      wget https://repo.continuum.io/miniconda/Miniconda2-latest-Linux-x86_64.sh -O miniconda.sh;
    else
      wget https://repo.continuum.io/miniconda/Miniconda3-latest-Linux-x86_64.sh -O miniconda.sh;
    fi
    && bash miniconda.sh -b -p $HOME/miniconda
    && export PATH="$HOME/miniconda/bin:$PATH"
    && hash -r
    && conda config --set always_yes yes --set changeps1 no
    && conda update -q conda
    && conda info -a
    && conda create -n test_env python=$TRAVIS_PYTHON_VERSION --yes
    && source activate test_env
    && python setup.py install
    && python -m pip install -r requirements_dev.txt
    && conda install --yes --file requirements_conda.txt;
  else
    pip install -U tox-travis;
  fi

script:
- if [[ "$TEST_ENV" == "conda" ]]; then pytest && sphinx-apidoc -o docs parameterize_jobs
  && sphinx-build -W -b html -d docs/_build/doctrees docs/. docs/_build/html; else
  tox; fi;

after_success:
- coveralls

deploy:
  provider: pypi
  distributions: sdist bdist_wheel
  user: delgadom
  password:
    secure: !!binary |
      VFFjS2VINUg2M2lrOThFQjMrOGRadG9pdVNNc3N2VzF5NDNGeVIyb1Y5aFI4UnN3K3Fna1lkbkpG
      dmhsZWN2eHdyZVgwMFBOcVd1d1pqVTZjdFB3ZG1XdjBMVCtTdTJNbzVPM2o3ZDVUdklFZzF4SW5N
      RE9QTm5XREVUVmhGdkZ4cW9OSmFzOWZYNkw1NGRxdWd4ajJvdlplN1pVTkd1L0lCZXd6WmdKOHQ1
      bTR2eEFYZzYrNXVEd2RtSnJFaVo2SEdJYUZkb1pNUVRraFpURjZFUU1KQkFjWHlFNGx3RGE3dDFD
      enBYOHVvcUFJR2pENDhkRUt4R3ZSMXU1dk4zUHI1ZjJQWHRyY1dVZVNZUDBwSGhrVHVaejIzdjJO
      ZjhsMmJ1aGFvb04yWFRMV1F2YldmN1RNb0UxR2dKcGk2RE5SaXRodFk0aklVRHFWdGF6QkpiRUph
      Zk9JbXhYdWFlR0pOb1A5U0gzNExlQ0RkWUhiQnJCQXhYRTQwd3piOXJ0VlNVVmRTd05iK3p3THNq
      RGcwVEJsc1ZEZjNGT2pYNVpMVmEwdjFvaWJhVWtUY01IZFRrcVRyQllhRFFZRkZsYW5CMnUxb3dp
      RXd4QTdnVmV1NFpwRHlHOGNxMFhQQzBTa3B6azR0MCtOcm9OallyV1lpS1ZJUHlpbElqR3czWUdT
      cGxwWmllRENqbjNEaUJIZStuK1RtVFZtcUM2NFdyOGdpUUdyK0dCOFFxMmZTMzkwK2RPSmk1bkJK
      WXBlZWhuYitJaHdoemNUMER3Sm9OTVBabFVQTVN1ZXRFcE5RR21PT3VRM2RlbGVUMnBPZlVRV1Ey
      ZjQzVVpYQWlYRjlEbm02ZjV2Sk8vTjhEZ3B5dHFCYUtudEdRd0lDc2xMZ2VSZDRXd0EyY0FVUlE9
  true:
    branch: master
    python: 2.7
    repo: delgadom/parameterize_jobs